<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å·¥ç¨‹è»Šæ¨‚åœ’ 3.0</title>

<style>
body{
    text-align:center;
    background:linear-gradient(#87CEEB,#FFF8DC);
    font-family:Arial;
    overflow:hidden;
}

h1{font-size:30px;}
#score,#timer{font-size:22px;margin:5px;}

#game{
    width:360px;
    margin:auto;
    display:grid;
    grid-template-columns:repeat(4,85px);
    gap:8px;
}

.tile{
    width:85px;
    height:85px;
    font-size:48px;
    background:white;
    border-radius:20px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:0.2s;
}

.tile.selected{background:#ffeb3b;}
.tile.hint{animation:glow 1s infinite;}
.explode{animation:boom 0.4s forwards;}

@keyframes glow{
    0%{box-shadow:0 0 5px orange;}
    50%{box-shadow:0 0 20px red;}
    100%{box-shadow:0 0 5px orange;}
}

@keyframes boom{
    0%{transform:scale(1);opacity:1;}
    100%{transform:scale(2);opacity:0;}
}

.rainbow{
    animation:rainbowBG 1s linear infinite;
}

@keyframes rainbowBG{
    0%{background:#ffadad;}
    25%{background:#ffd6a5;}
    50%{background:#caffbf;}
    75%{background:#9bf6ff;}
    100%{background:#ffadad;}
}

button{
    font-size:20px;
    padding:10px 20px;
    margin:10px;
}
</style>
</head>

<body>

<h1>ğŸšœ å·¥ç¨‹è»Šæ¨‚åœ’ ğŸš’</h1>
<div id="score">å¾—åˆ†ï¼š0</div>
<div id="timer">æ™‚é–“ï¼š30</div>
<button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
<div id="game"></div>

<script>
const vehicles=["ğŸšœ","ğŸš’","ğŸš›","ğŸš§"];
const names={
    "ğŸšœ":"æŒ–åœŸæ©Ÿä¾†å›‰ï¼",
    "ğŸš’":"æ¶ˆé˜²è»Šå‡ºå‹•ï¼",
    "ğŸš›":"å¤§å¡è»Šè½Ÿéš†éš†ï¼",
    "ğŸš§":"å·¥ç¨‹é–‹å§‹å›‰ï¼"
};

let board=[];
let selected=[];
let score=0;
let timeLeft=30;
let timerInterval=null;

const game=document.getElementById("game");
const scoreDisplay=document.getElementById("score");
const timerDisplay=document.getElementById("timer");

function startGame(){
    score=0;
    timeLeft=30;
    scoreDisplay.textContent="å¾—åˆ†ï¼š"+score;
    timerDisplay.textContent="æ™‚é–“ï¼š"+timeLeft;
    createBoard();
    startTimer();
    playBGMusic();
}

function createBoard(){
    game.innerHTML="";
    board=[];
    for(let i=0;i<16;i++){
        let tile=document.createElement("div");
        tile.classList.add("tile");
        tile.textContent=randomVehicle();
        tile.addEventListener("click",selectTile);
        game.appendChild(tile);
        board.push(tile);
    }
    showHint();
}

function randomVehicle(){
    return vehicles[Math.floor(Math.random()*vehicles.length)];
}

function selectTile(){
    if(selected.includes(this))return;
    this.classList.add("selected");
    selected.push(this);

    if(selected.length===3){
        checkMatch();
    }
}

function checkMatch(){
    let icons=selected.map(t=>t.textContent);
    if(icons[0]===icons[1] && icons[1]===icons[2]){
        score+=20;
        scoreDisplay.textContent="å¾—åˆ†ï¼š"+score;
        speak(names[icons[0]]);
        rainbowEffect();

        selected.forEach(t=>t.classList.add("explode"));

        setTimeout(()=>{
            selected.forEach(t=>{
                t.classList.remove("explode","selected");
                t.textContent=randomVehicle();
            });
            selected=[];
            showHint();
        },400);

    }else{
        setTimeout(()=>{
            selected.forEach(t=>t.classList.remove("selected"));
            selected=[];
        },400);
    }
}

function showHint(){
    board.forEach(t=>t.classList.remove("hint"));
    let counts={};
    board.forEach(t=>{
        counts[t.textContent]=(counts[t.textContent]||0)+1;
    });
    for(let v in counts){
        if(counts[v]>=3){
            let shown=0;
            board.forEach(t=>{
                if(t.textContent===v && shown<3){
                    t.classList.add("hint");
                    shown++;
                }
            });
            break;
        }
    }
}

function startTimer(){
    clearInterval(timerInterval);
    timerInterval=setInterval(()=>{
        timeLeft--;
        timerDisplay.textContent="æ™‚é–“ï¼š"+timeLeft;
        if(timeLeft<=0){
            clearInterval(timerInterval);
            alert("éŠæˆ²çµæŸï¼ç¸½å¾—åˆ†ï¼š"+score);
        }
    },1000);
}

function speak(text){
    let utter=new SpeechSynthesisUtterance(text);
    utter.lang="zh-TW";
    speechSynthesis.speak(utter);
}

function rainbowEffect(){
    document.body.classList.add("rainbow");
    setTimeout(()=>document.body.classList.remove("rainbow"),800);
}

function playBGMusic(){
    const bg=new Audio("https://actions.google.com/sounds/v1/ambiences/barnyard.ogg");
    bg.loop=true;
    bg.volume=0.2;
    bg.play();
}

// ğŸ“± æ–æ™ƒæ‰‹æ©Ÿçˆ†ç‚¸æ¨¡å¼
let lastShake=0;
window.addEventListener("devicemotion",function(e){
    let acc=e.accelerationIncludingGravity;
    let total=Math.abs(acc.x)+Math.abs(acc.y)+Math.abs(acc.z);
    if(total>30){
        if(Date.now()-lastShake>1000){
            lastShake=Date.now();
            board.forEach(t=>{
                t.textContent=randomVehicle();
            });
            rainbowEffect();
            speak("å…¨éƒ¨é‡ä¾†ï¼");
        }
    }
});
</script>

</body>
</html>