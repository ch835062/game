<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åƒç´ é‡£é­šéŠæˆ²</title>
<style>
body {
  background:#87CEEB;
  text-align:center;
  margin:0;
  font-family:monospace;
}
canvas{
  image-rendering: pixelated;
  border:4px solid #000;
  background:#4ec0ff;
  margin-top:10px;
}
button{
  padding:10px 20px;
  font-size:16px;
  margin-top:10px;
}
</style>
</head>
<body>

<h2>ğŸ£ åƒç´ é‡£é­šå¤ªéƒ</h2>
<canvas id="game" width="320" height="480"></canvas>
<br>
<button onclick="cast()">æ‹‹ç«¿</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

ctx.imageSmoothingEnabled = false;

let state = "idle";
let fishTimer = 0;
let power = 0;
let score = 0;
let fishName = "";

const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function beep(freq){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.frequency.value=freq;
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.2);
  o.stop(audioCtx.currentTime+0.2);
}

function cast(){
  if(state!=="idle")return;
  state="waiting";
  fishTimer = Math.random()*200+100;
  beep(300);
}

document.addEventListener("keydown",e=>{
  if(e.code==="Space" && state==="bite"){
    state="reeling";
  }
});

canvas.addEventListener("click",()=>{
  if(state==="bite"){
    state="reeling";
  }
});

function update(){
  if(state==="waiting"){
    fishTimer--;
    if(fishTimer<=0){
      state="bite";
      beep(800);
    }
  }

  if(state==="reeling"){
    power+=2;
    if(power>=100){
      catchFish();
    }
  }
}

function catchFish(){
  const fishes=[
    {name:"å°é­š",score:10},
    {name:"å¤§é­š",score:30},
    {name:"ç¨€æœ‰é­š",score:100}
  ];
  const f = fishes[Math.floor(Math.random()*fishes.length)];
  score+=f.score;
  fishName=f.name;
  beep(600);
  state="result";
  setTimeout(()=>{
    state="idle";
    power=0;
  },1500);
}

function draw(){
  ctx.clearRect(0,0,320,480);

  // æ°´é¢
  ctx.fillStyle="#0066aa";
  ctx.fillRect(0,200,320,280);

  // é‡£ç«¿
  ctx.fillStyle="#8B4513";
  ctx.fillRect(150,0,5,200);

  // ç·š
  if(state!=="idle"){
    ctx.fillStyle="#fff";
    ctx.fillRect(152,200,2,100);
  }

  // åŠ›é‡æ¢
  if(state==="reeling"){
    ctx.fillStyle="#000";
    ctx.fillRect(60,420,200,20);
    ctx.fillStyle="#0f0";
    ctx.fillRect(60,420,power*2,20);
  }

  ctx.fillStyle="#000";
  ctx.fillText("é‡‘å¹£:"+score,10,20);

  if(state==="bite"){
    ctx.fillStyle="#ff0";
    ctx.fillText("é­šä¸Šé‰¤ï¼å¿«é»æ“Šï¼",90,180);
  }

  if(state==="result"){
    ctx.fillStyle="#fff";
    ctx.fillText("é‡£åˆ°:"+fishName,110,160);
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>