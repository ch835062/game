<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>Fishing MVP</title>
<style>
  body {
    background: #222;
    color: #fff;
    font-family: monospace;
    text-align: center;
  }

  #game {
    width: 400px;
    margin: 20px auto;
    padding: 10px;
    background: #333;
    border: 4px solid #555;
  }

  button {
    font-size: 16px;
    padding: 8px 16px;
    cursor: pointer;
  }

  #bar {
    position: relative;
    width: 300px;
    height: 20px;
    background: #800;
    margin: 20px auto;
  }

  #success {
    position: absolute;
    height: 100%;
    background: #0a0;
  }

  #pointer {
    position: absolute;
    top: -5px;
    width: 4px;
    height: 30px;
    background: #fff;
  }
</style>
</head>
<body>

<h1>ðŸŽ£ Fishing MVP</h1>

<div id="game">
  <div id="status">IDLE</div>
  <div id="money">ðŸ’° 0</div>

  <button id="castBtn">æ‹‹ç«¿</button>

  <div id="bar" style="display:none;">
    <div id="success"></div>
    <div id="pointer"></div>
  </div>
</div>

<script>
/* ---------- ç‹€æ…‹ ---------- */
let gameState = "IDLE"
let money = 0
let currentFish = null

const fishTable = [
  { name: "å°é­š", price: 10, reelTime: 2, successZone: 0.4, speed: 0.6 },
  { name: "ä¸­é­š", price: 30, reelTime: 3, successZone: 0.25, speed: 1.0 },
  { name: "å¤§é­š", price: 80, reelTime: 4, successZone: 0.15, speed: 1.4 }
]

/* ---------- DOM ---------- */
const statusEl = document.getElementById("status")
const moneyEl = document.getElementById("money")
const barEl = document.getElementById("bar")
const successEl = document.getElementById("success")
const pointerEl = document.getElementById("pointer")
const castBtn = document.getElementById("castBtn")

/* ---------- æ‹‰ç·šåƒæ•¸ ---------- */
let pointer = 0.5
let direction = 1
let progress = 0
let danger = 0
let holding = false
let lastTime = null

/* ---------- å·¥å…· ---------- */
function setState(state) {
  gameState = state
  statusEl.textContent = state
}

/* ---------- æ‹‹ç«¿ ---------- */
castBtn.onclick = () => {
  if (gameState !== "IDLE") return
  setState("WAITING")

  setTimeout(() => {
    setState("REELING")
    startReel()
  }, Math.random() * 2000 + 1000)
}

/* ---------- æ‹‰ç·šé–‹å§‹ ---------- */
function startReel() {
  currentFish = fishTable[Math.floor(Math.random() * fishTable.length)]
  pointer = 0.5
  progress = 0
  danger = 0
  barEl.style.display = "block"

  successEl.style.left = (0.5 - currentFish.successZone / 2) * 300 + "px"
  successEl.style.width = currentFish.successZone * 300 + "px"

  lastTime = performance.now()
  requestAnimationFrame(loop)
}

/* ---------- ä¸»è¿´åœˆ ---------- */
function loop(time) {
  if (gameState !== "REELING") return

  const dt = (time - lastTime) / 1000
  lastTime = time

  pointer += dt * currentFish.speed * (holding ? 1 : -1)
  pointer = Math.max(0, Math.min(1, pointer))

  const left = 0.5 - currentFish.successZone / 2
  const right = 0.5 + currentFish.successZone / 2

  if (pointer >= left && pointer <= right) {
    progress += dt
    danger = Math.max(0, danger - dt)
  } else {
    danger += dt
  }

  pointerEl.style.left = pointer * 300 + "px"

  if (progress >= currentFish.reelTime) {
    money += currentFish.price
    moneyEl.textContent = "ðŸ’° " + money
    endReel("æˆåŠŸé‡£åˆ° " + currentFish.name)
    return
  }

  if (danger >= 1.5) {
    endReel("é­šè·‘æŽ‰äº†ï¼")
    return
  }

  requestAnimationFrame(loop)
}

/* ---------- çµæŸ ---------- */
function endReel(msg) {
  alert(msg)
  barEl.style.display = "none"
  setState("IDLE")
}

/* ---------- æ“ä½œ ---------- */
document.addEventListener("mousedown", () => holding = true)
document.addEventListener("mouseup", () => holding = false)
document.addEventListener("touchstart", () => holding = true)
document.addEventListener("touchend", () => holding = false)
</script>

</body>
</html>
