<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å·¥ç¨‹è»Šæ¶ˆæ¶ˆæ¨‚</title>

<style>
body {
    text-align: center;
    background: #fff8dc;
    font-family: Arial, sans-serif;
}

h1 {
    font-size: 36px;
}

#game {
    width: 360px;
    margin: auto;
    display: grid;
    grid-template-columns: repeat(4, 90px);
    grid-gap: 5px;
}

.tile {
    width: 90px;
    height: 90px;
    font-size: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 15px;
    cursor: pointer;
}

.tile.selected {
    background: #ffeb3b;
}

#score {
    font-size: 24px;
    margin: 15px;
}
</style>
</head>

<body>

<h1>ðŸšœ å·¥ç¨‹è»Šæ¶ˆæ¶ˆæ¨‚ ðŸš’</h1>
<div id="score">å¾—åˆ†ï¼š0</div>
<div id="game"></div>

<script>
const vehicles = ["ðŸšœ", "ðŸš’", "ðŸš›", "ðŸš§"];
const boardSize = 4;
let board = [];
let firstTile = null;
let score = 0;

const game = document.getElementById("game");
const scoreDisplay = document.getElementById("score");

function createBoard() {
    board = [];
    game.innerHTML = "";
    for (let i = 0; i < boardSize * boardSize; i++) {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.dataset.index = i;
        tile.textContent = vehicles[Math.floor(Math.random() * vehicles.length)];
        tile.addEventListener("click", selectTile);
        game.appendChild(tile);
        board.push(tile);
    }
}

function selectTile() {
    if (!firstTile) {
        firstTile = this;
        this.classList.add("selected");
    } else {
        swapTiles(firstTile, this);
        firstTile.classList.remove("selected");
        firstTile = null;
        checkMatches();
    }
}

function swapTiles(tile1, tile2) {
    const temp = tile1.textContent;
    tile1.textContent = tile2.textContent;
    tile2.textContent = temp;
}

function checkMatches() {
    let matched = false;

    // æª¢æŸ¥æ©«æŽ’
    for (let row = 0; row < boardSize; row++) {
        for (let col = 0; col < boardSize - 2; col++) {
            let i = row * boardSize + col;
            if (board[i].textContent &&
                board[i].textContent === board[i+1].textContent &&
                board[i].textContent === board[i+2].textContent) {

                board[i].textContent = "";
                board[i+1].textContent = "";
                board[i+2].textContent = "";
                score += 10;
                matched = true;
            }
        }
    }

    // æª¢æŸ¥ç›´æŽ’
    for (let col = 0; col < boardSize; col++) {
        for (let row = 0; row < boardSize - 2; row++) {
            let i = row * boardSize + col;
            if (board[i].textContent &&
                board[i].textContent === board[i+boardSize].textContent &&
                board[i].textContent === board[i+boardSize*2].textContent) {

                board[i].textContent = "";
                board[i+boardSize].textContent = "";
                board[i+boardSize*2].textContent = "";
                score += 10;
                matched = true;
            }
        }
    }

    if (matched) {
        playSound();
        scoreDisplay.textContent = "å¾—åˆ†ï¼š" + score;
        setTimeout(dropTiles, 300);
    }
}

function dropTiles() {
    for (let col = 0; col < boardSize; col++) {
        for (let row = boardSize - 1; row >= 0; row--) {
            let i = row * boardSize + col;
            if (board[i].textContent === "") {
                for (let k = row - 1; k >= 0; k--) {
                    let above = k * boardSize + col;
                    if (board[above].textContent !== "") {
                        board[i].textContent = board[above].textContent;
                        board[above].textContent = "";
                        break;
                    }
                }
                if (board[i].textContent === "") {
                    board[i].textContent = vehicles[Math.floor(Math.random() * vehicles.length)];
                }
            }
        }
    }
}

function playSound() {
    const audio = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
    audio.play();
}

createBoard();
</script>

</body>
</html>