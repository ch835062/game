function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const tileW = Math.min(canvas.width, canvas.height)/8;
  const tileH = tileW/2;
  const tileZ = tileW/2;

  const maxLayers = Math.ceil(canvas.height / tileZ);

  let cubes = [];

  for(let z=0; z<maxLayers; z++){
    for(let y=0; y<mapRows; y++){
      for(let x=0; x<mapCols; x++){

        let type;

        // ðŸ”¥ æœ€åº•å±¤æ‰æ˜¯åŽŸæœ¬åœ°åœ–
        if(z === maxLayers-1){
          type = topMap[y][x];
        }else{
          type = 0; // å…¶ä»–å…¨æ°´
        }

        cubes.push({x,y,z,type,depth:x+y+(maxLayers-z)});
      }
    }
  }

  cubes.sort((a,b)=>a.depth-b.depth);

  cubes.forEach(c=>{
    drawCube(
      c.x,
      c.y,
      c.z,
      tileW,
      tileH,
      tileZ,
      c.type===1
      ? {top:"#4caf50",left:"#388e3c",right:"#2e7d32"}
      : {top:"#2196f3",left:"#1976d2",right:"#1565c0"}
    );
  });

  requestAnimationFrame(render);
}