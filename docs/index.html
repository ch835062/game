<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åƒç´ é‡£é­š - æ¸¸å‹•é­šç‰ˆ</title>
<style>
body{
  margin:0;
  background:#87CEEB;
  text-align:center;
  font-family:monospace;
}
canvas{
  image-rendering: pixelated;
  border:4px solid #000;
  background:#4ec0ff;
}
button{
  margin-top:10px;
  padding:8px 16px;
  font-size:16px;
}
</style>
</head>
<body>

<h2>ğŸ£ åƒç´ é‡£é­šï¼ˆé­šæœƒæ¸¸å‹•ï¼‰</h2>
<canvas id="game" width="320" height="480"></canvas>
<br>
<button onclick="cast()">æ‹‹ç«¿</button>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
ctx.imageSmoothingEnabled=false;

let state="idle";
let hookY=0;
let fishList=[];
let hookedFish=null;
let score=0;

/* ===== éŸ³æ•ˆ ===== */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(freq){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.frequency.value=freq;
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.2);
  o.stop(audioCtx.currentTime+0.2);
}

/* ===== ç”¢ç”Ÿé­š ===== */
function spawnFish(){
  const types=[
    {color:"#ff4444",size:16,score:10},
    {color:"#ffaa00",size:20,score:20},
    {color:"#00ffcc",size:24,score:50}
  ];
  const t=types[Math.floor(Math.random()*types.length)];
  fishList.push({
    x:Math.random()*300,
    y:220+Math.random()*200,
    vx:(Math.random()<0.5?-1:1)*(1+Math.random()*1.5),
    ...t
  });
}
setInterval(spawnFish,1500);

/* ===== æ‹‹ç«¿ ===== */
function cast(){
  if(state!=="idle")return;
  state="dropping";
  hookY=0;
  beep(300);
}

canvas.addEventListener("click",()=>{
  if(state==="hooked"){
    state="reeling";
    beep(700);
  }
});

document.addEventListener("keydown",e=>{
  if(e.code==="Space"&&state==="hooked"){
    state="reeling";
  }
});

/* ===== æ›´æ–° ===== */
function update(){

  // é­šæ¸¸å‹•
  fishList.forEach(f=>{
    f.x+=f.vx;
    if(f.x<0||f.x>320-f.size){
      f.vx*=-1;
    }
  });

  if(state==="dropping"){
    hookY+=4;
    if(hookY>400) state="idle";
    fishList.forEach(f=>{
      if(
        hookY>f.y &&
        hookY<f.y+f.size &&
        150>f.x &&
        155<f.x+f.size
      ){
        hookedFish=f;
        state="hooked";
        beep(900);
      }
    });
  }

  if(state==="reeling"){
    hookY-=4;
    if(hookedFish){
      hookedFish.y=hookY;
      hookedFish.x=150;
    }
    if(hookY<=0){
      score+=hookedFish.score;
      fishList=fishList.filter(f=>f!==hookedFish);
      hookedFish=null;
      state="idle";
    }
  }
}

/* ===== ç•«åƒç´ é­š ===== */
function drawFish(f){
  ctx.fillStyle=f.color;
  ctx.fillRect(f.x,f.y,f.size,f.size/2);
  ctx.fillRect(f.x-4,f.y+4,4,4);
}

/* ===== ç•«é¢ ===== */
function draw(){
  ctx.clearRect(0,0,320,480);

  // æ°´é¢
  ctx.fillStyle="#0066aa";
  ctx.fillRect(0,200,320,280);

  // é‡£ç«¿
  ctx.fillStyle="#8B4513";
  ctx.fillRect(150,0,4,200);

  // ç·š
  if(state!=="idle"){
    ctx.fillStyle="#fff";
    ctx.fillRect(152,200,2,hookY);
  }

  // é­š
  fishList.forEach(drawFish);

  // åˆ†æ•¸
  ctx.fillStyle="#000";
  ctx.fillText("é‡‘å¹£:"+score,10,20);

  if(state==="hooked"){
    ctx.fillStyle="#ff0";
    ctx.fillText("é­šä¸Šé‰¤ï¼é»æ“Šæ”¶ç·šï¼",70,180);
  }
}

/* ===== ä¸»è¿´åœˆ ===== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>