<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>æ‰“ç£šå¡ŠéŠæˆ²</title>
<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  text-align: center;
  font-family: Arial, sans-serif;
}
canvas {
  background: #000;
  display: block;
  margin: auto;
  border: 2px solid #444;
}
#info {
  padding: 6px;
  font-size: 14px;
}
</style>
</head>
<body>

<h2>ğŸ§± æ‰“ç£šå¡ŠéŠæˆ²</h2>
<div id="info">æ‰‹æ©Ÿå¯æ–æ™ƒæ§åˆ¶ï½œæ¡Œæ©Ÿæ»‘é¼ æˆ–æ–¹å‘éµ</div>
<canvas id="game" width="360" height="520"></canvas>

<script>
/* ===== åŸºæœ¬è¨­å®š ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let paddle = { x: 140, y: 480, w: 80, h: 12 };
let balls = [];
let items = [];
let score = 0;
let gameOver = false;

/* ===== éŸ³æ•ˆ ===== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq, duration = 0.1) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.frequency.value = freq;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
  osc.stop(audioCtx.currentTime + duration);
}

/* ===== çƒ ===== */
function createBall(x, y, speed = 3) {
  balls.push({ x, y, vx: speed, vy: -speed, r: 6 });
}
createBall(180, 450);

/* ===== ç£šå¡Š ===== */
let bricks = [];
const rows = 5, cols = 7;
for (let r = 0; r < rows; r++) {
  for (let c = 0; c < cols; c++) {
    bricks.push({
      x: 20 + c * 45,
      y: 40 + r * 25,
      w: 40,
      h: 15,
      alive: true
    });
  }
}

/* ===== é“å…· ===== */
function dropItem(x, y) {
  const types = ["multi", "long", "slow", "fast"];
  items.push({
    x, y, type: types[Math.floor(Math.random() * types.length)],
    size: 12
  });
}

function applyItem(type) {
  playSound(600);
  if (type === "multi") {
    balls.forEach(b => createBall(b.x, b.y, 3));
  }
  if (type === "long") {
    paddle.w = 140;
    setTimeout(() => paddle.w = 80, 8000);
  }
  if (type === "slow") {
    balls.forEach(b => { b.vx *= 0.6; b.vy *= 0.6; });
  }
  if (type === "fast") {
    balls.forEach(b => { b.vx *= 1.4; b.vy *= 1.4; });
  }
}

/* ===== æ§åˆ¶ï¼ˆæ»‘é¼ ï¼‰ ===== */
canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  paddle.x = e.clientX - rect.left - paddle.w / 2;
});

/* ===== æ§åˆ¶ï¼ˆéµç›¤ï¼‰ ===== */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") paddle.x -= 20;
  if (e.key === "ArrowRight") paddle.x += 20;
});

/* ===== æ‰‹æ©Ÿæ–æ™ƒæ§åˆ¶ ===== */
window.addEventListener("devicemotion", e => {
  const acc = e.accelerationIncludingGravity;
  if (!acc) return;
  paddle.x += acc.x * 2;
});

/* ===== éŠæˆ²æ›´æ–° ===== */
function update() {
  if (gameOver) return;

  balls.forEach(ball => {
    ball.x += ball.vx;
    ball.y += ball.vy;

    if (ball.x < ball.r || ball.x > canvas.width - ball.r) {
      ball.vx *= -1;
      playSound(300);
    }
    if (ball.y < ball.r) {
      ball.vy *= -1;
      playSound(300);
    }

    if (
      ball.y + ball.r > paddle.y &&
      ball.x > paddle.x &&
      ball.x < paddle.x + paddle.w
    ) {
      ball.vy *= -1;
      playSound(500);
    }

    bricks.forEach(b => {
      if (b.alive &&
          ball.x > b.x && ball.x < b.x + b.w &&
          ball.y > b.y && ball.y < b.y + b.h) {
        b.alive = false;
        ball.vy *= -1;
        score += 10;
        playSound(800);
        if (Math.random() < 0.3) dropItem(b.x + b.w / 2, b.y);
      }
    });
  });

  balls = balls.filter(b => b.y < canvas.height + 20);
  if (balls.length === 0) gameOver = true;

  items.forEach(i => {
    i.y += 2;
    if (i.y > paddle.y &&
        i.x > paddle.x &&
        i.x < paddle.x + paddle.w) {
      applyItem(i.type);
      i.hit = true;
    }
  });
  items = items.filter(i => !i.hit);
}

/* ===== ç¹ªåœ– ===== */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // æ¿å­
  ctx.fillStyle = "#0f0";
  ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

  // çƒ
  ctx.fillStyle = "#fff";
  balls.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
    ctx.fill();
  });

  // ç£šå¡Š
  bricks.forEach(b => {
    if (b.alive) {
      ctx.fillStyle = "#f44";
      ctx.fillRect(b.x, b.y, b.w, b.h);
    }
  });

  // é“å…·
  items.forEach(i => {
    ctx.fillStyle = "#ff0";
    ctx.fillRect(i.x - 6, i.y - 6, 12, 12);
  });

  ctx.fillStyle = "#fff";
  ctx.fillText("Score: " + score, 10, 15);

  if (gameOver) {
    ctx.font = "24px Arial";
    ctx.fillText("GAME OVER", 110, 260);
  }
}

/* ===== ä¸»è¿´åœˆ ===== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
