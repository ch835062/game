<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2.5D 等角釣魚場景</title>
<style>
body{ margin:0; background:#111; overflow:hidden; }
canvas{ display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// ===== 地圖 =====
const mapRows = 8;
const mapCols = 8;

const map = [
  [1,1,1,1,1,1,1,1],
  [1,1,1,0,0,1,1,1],
  [1,1,0,0,0,0,1,1],
  [1,0,0,0,0,0,0,1],
  [1,1,0,0,0,0,1,1],
  [1,1,1,0,0,1,1,1],
  [1,1,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,1],
];

function isoToScreen(x, y, tileW, tileH){
  return {
    x: (x - y) * tileW / 2,
    y: (x + y) * tileH / 2
  };
}

// ===== 角色位置（岸邊）=====
const player = {
  x: 2,
  y: 1
};

let time = 0;

function drawCube(x, y, tileW, tileH, height, colors){

  const pos = isoToScreen(x, y, tileW, tileH);
  const centerX = canvas.width/2;
  const centerY = canvas.height/4;

  const screenX = pos.x + centerX;
  const screenY = pos.y + centerY;

  // 上
  ctx.fillStyle = colors.top;
  ctx.beginPath();
  ctx.moveTo(screenX, screenY - height);
  ctx.lineTo(screenX + tileW/2, screenY - tileH/2 - height);
  ctx.lineTo(screenX, screenY - tileH - height);
  ctx.lineTo(screenX - tileW/2, screenY - tileH/2 - height);
  ctx.closePath();
  ctx.fill();

  // 左
  ctx.fillStyle = colors.left;
  ctx.beginPath();
  ctx.moveTo(screenX - tileW/2, screenY - tileH/2 - height);
  ctx.lineTo(screenX - tileW/2, screenY - tileH/2);
  ctx.lineTo(screenX, screenY);
  ctx.lineTo(screenX, screenY - height);
  ctx.closePath();
  ctx.fill();

  // 右
  ctx.fillStyle = colors.right;
  ctx.beginPath();
  ctx.moveTo(screenX + tileW/2, screenY - tileH/2 - height);
  ctx.lineTo(screenX + tileW/2, screenY - tileH/2);
  ctx.lineTo(screenX, screenY);
  ctx.lineTo(screenX, screenY - height);
  ctx.closePath();
  ctx.fill();
}

// ===== 畫角色 =====
function drawPlayer(tileW, tileH, landHeight){

  const centerX = canvas.width/2;
  const centerY = canvas.height/4;

  const pos = isoToScreen(player.x, player.y, tileW, tileH);
  const screenX = pos.x + centerX;
  const screenY = pos.y + centerY;

  const baseY = screenY - landHeight;

  // 身體
  ctx.fillStyle = "#ff5722";
  ctx.beginPath();
  ctx.arc(screenX, baseY - tileH/2, tileW/6, 0, Math.PI*2);
  ctx.fill();

  // 釣竿
  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(screenX, baseY - tileH/2);
  ctx.lineTo(screenX + tileW/2, baseY - tileH);
  ctx.stroke();
}

// ===== 魚 =====
let fishes = [];
function createFish(){
  return {
    x: 2 + Math.random()*4,
    y: 2 + Math.random()*4,
    vx: (Math.random()-0.5)*0.02,
    vy: (Math.random()-0.5)*0.02,
  };
}
for(let i=0;i<6;i++) fishes.push(createFish());

function drawFish(tileW, tileH, waterHeight){

  const centerX = canvas.width/2;
  const centerY = canvas.height/4;

  fishes.forEach(fish => {

    fish.x += fish.vx;
    fish.y += fish.vy;

    if(fish.x < 2 || fish.x > 5) fish.vx *= -1;
    if(fish.y < 2 || fish.y > 5) fish.vy *= -1;

    const pos = isoToScreen(fish.x, fish.y, tileW, tileH);
    const screenX = pos.x + centerX;
    const screenY = pos.y + centerY - waterHeight/2;

    ctx.fillStyle = "rgba(0,0,0,0.25)";
    ctx.beginPath();
    ctx.ellipse(screenX, screenY, tileW/6, tileH/4, 0, 0, Math.PI*2);
    ctx.fill();
  });
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const tileW = Math.min(canvas.width, canvas.height) / 8;
  const tileH = tileW / 2;

  const landHeight = tileW/2;
  const waterHeight = tileW/3;

  // 深度排序 (y + x)
  let tiles = [];
  for(let y=0; y<mapRows; y++){
    for(let x=0; x<mapCols; x++){
      tiles.push({x,y,type:map[y][x],depth:x+y});
    }
  }

  tiles.sort((a,b)=>a.depth-b.depth);

  tiles.forEach(tile=>{
    if(tile.type===1){
      drawCube(tile.x,tile.y,tileW,tileH,landHeight,{
        top:"#4caf50", left:"#388e3c", right:"#2e7d32"
      });
    }else{
      const wave = Math.sin(time + tile.x + tile.y)*4;
      drawCube(tile.x,tile.y,tileW,tileH,waterHeight+wave,{
        top:"#2196f3", left:"#1976d2", right:"#1565c0"
      });
    }
  });

  drawFish(tileW,tileH,waterHeight);
  drawPlayer(tileW,tileH,landHeight);

  time+=0.05;
  requestAnimationFrame(render);
}

render();
</script>
</body>
</html>