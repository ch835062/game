<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FCé¢¨é‡£é­šå¤ªéƒ</title>
<style>
body{
  margin:0;
  background:#6ec6ff;
  text-align:center;
  font-family:monospace;
}
canvas{
  image-rendering: pixelated;
  border:4px solid #000;
  background:#87CEEB;
}
button{
  margin-top:8px;
  padding:6px 16px;
}
</style>
</head>
<body>

<h2>ğŸ£ FCé¢¨ é‡£é­šå¤ªéƒ</h2>
<canvas id="game" width="320" height="480"></canvas>
<br>
<button onclick="cast()">æ‹‹ç«¿</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

let state="idle";
let hookY=0;
let tension=0;
let holding=false;
let hookedFish=null;
let score=0;

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(freq){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.frequency.value=freq;
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+0.15);
  o.stop(audioCtx.currentTime+0.15);
}

/* ===== é­š AI ===== */
let fishList=[];
function spawnFish(){
  const types=[
    {size:16,power:0.5,color:"#333"},
    {size:20,power:1,color:"#222"},
    {size:26,power:1.5,color:"#111"}
  ];
  const t=types[Math.floor(Math.random()*types.length)];
  fishList.push({
    x:Math.random()*280,
    y:260+Math.random()*150,
    vx:(Math.random()<0.5?-1:1)*1.2,
    interest:0,
    ...t
  });
}
setInterval(spawnFish,2000);

/* ===== æ§åˆ¶ ===== */
document.addEventListener("keydown",e=>{
  if(e.code==="Space"){
    if(state==="bite"){
      state="fight";
      hookedFish=targetFish;
      beep(800);
    }
    holding=true;
  }
});
document.addEventListener("keyup",()=>holding=false);
canvas.addEventListener("mousedown",()=>holding=true);
canvas.addEventListener("mouseup",()=>holding=false);

function cast(){
  if(state!=="idle")return;
  state="waiting";
  hookY=220;
  beep(300);
}

/* ===== æ›´æ–° ===== */
let biteTimer=0;
let targetFish=null;

function update(){

  // é­šå·¡èˆª
  fishList.forEach(f=>{
    f.x+=f.vx;
    if(f.x<0||f.x>320-f.size)f.vx*=-1;

    // æ¥è¿‘é¤Œå¢åŠ èˆˆè¶£
    if(state==="waiting"){
      let dx=Math.abs(f.x-150);
      let dy=Math.abs(f.y-hookY);
      if(dx<30&&dy<20){
        f.interest+=0.02;
        if(f.interest>1){
          state="bite";
          targetFish=f;
          biteTimer=60;
          beep(1000);
        }
      }else{
        f.interest=Math.max(0,f.interest-0.01);
      }
    }
  });

  // å’¬é‰¤åæ‡‰æ™‚é–“
  if(state==="bite"){
    biteTimer--;
    if(biteTimer<=0){
      state="waiting";
    }
  }

  // æ‹‰é‹¸æˆ°
  if(state==="fight" && hookedFish){
    if(holding){
      tension+=2*hookedFish.power;
      hookY-=1;
    }else{
      tension-=1.5;
    }

    // é­šçˆ†è¡
    if(Math.random()<0.02){
      tension+=10*hookedFish.power;
    }

    tension=Math.max(0,tension);

    if(tension>100){
      state="idle";
      tension=0;
      hookedFish=null;
      beep(200);
    }

    if(hookY<=220){
      score+=Math.floor(50*hookedFish.power);
      fishList=fishList.filter(f=>f!==hookedFish);
      state="idle";
      tension=0;
      hookedFish=null;
      beep(600);
    }
  }
}

/* ===== ç¹ªåœ– ===== */
function draw(){
  ctx.clearRect(0,0,320,480);

  // å²¸é‚Š
  ctx.fillStyle="#228B22";
  ctx.fillRect(0,200,320,40);

  // æ°´
  ctx.fillStyle="#1e90ff";
  ctx.fillRect(0,240,320,240);

  // é­šå½±
  fishList.forEach(f=>{
    ctx.fillStyle=f.color;
    ctx.fillRect(f.x,f.y,f.size,f.size/3);
  });

  // é‡£ç·š
  if(state!=="idle"){
    ctx.fillStyle="#fff";
    ctx.fillRect(150,200,2,hookY-200);
  }

  // å¼µåŠ›æ¢
  ctx.fillStyle="#000";
  ctx.fillRect(20,20,120,10);
  ctx.fillStyle=tension>70?"#f00":"#0f0";
  ctx.fillRect(20,20,tension,10);

  ctx.fillStyle="#000";
  ctx.fillText("é‡‘å¹£:"+score,200,30);

  if(state==="bite"){
    ctx.fillStyle="#ff0";
    ctx.fillText("ï¼",150,180);
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>