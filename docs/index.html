<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>小立方體堆疊大立方體</title>
<style>
body{margin:0;background:#111;overflow:hidden;}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
}
window.addEventListener("resize",resize);
resize();

function iso(x,y,z,tileW,tileH,tileZ){
  return{
    x:(x-y)*tileW/2,
    y:(x+y)*tileH/2 - z*tileZ
  }
}

const size=6;      // X,Y 寬度
const height=4;    // Z 高度

let time=0;

function drawCube(x,y,z,tileW,tileH,tileZ,color){

  const p=iso(x,y,z,tileW,tileH,tileZ);
  const cx=canvas.width/2;
  const cy=canvas.height/3;

  const sx=p.x+cx;
  const sy=p.y+cy;

  // 上
  ctx.fillStyle=color.top;
  ctx.beginPath();
  ctx.moveTo(sx,sy);
  ctx.lineTo(sx+tileW/2,sy-tileH/2);
  ctx.lineTo(sx,sy-tileH);
  ctx.lineTo(sx-tileW/2,sy-tileH/2);
  ctx.closePath();
  ctx.fill();

  // 左
  ctx.fillStyle=color.left;
  ctx.beginPath();
  ctx.moveTo(sx-tileW/2,sy-tileH/2);
  ctx.lineTo(sx-tileW/2,sy-tileH/2+tileZ);
  ctx.lineTo(sx,sy+tileZ);
  ctx.lineTo(sx,sy);
  ctx.closePath();
  ctx.fill();

  // 右
  ctx.fillStyle=color.right;
  ctx.beginPath();
  ctx.moveTo(sx+tileW/2,sy-tileH/2);
  ctx.lineTo(sx+tileW/2,sy-tileH/2+tileZ);
  ctx.lineTo(sx,sy+tileZ);
  ctx.lineTo(sx,sy);
  ctx.closePath();
  ctx.fill();
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const tileW=Math.min(canvas.width,canvas.height)/12;
  const tileH=tileW/2;
  const tileZ=tileW/2;

  let cubes=[];

  for(let x=0;x<size;x++){
    for(let y=0;y<size;y++){
      for(let z=0;z<height;z++){

        // 中央挖空形成水池
        if(
          x>=2&&x<=3 &&
          y>=2&&y<=3 &&
          z>=2
        ){
          continue;
        }

        cubes.push({x,y,z});
      }
    }
  }

  // 深度排序
  cubes.sort((a,b)=>{
    return (a.x+a.y+a.z)-(b.x+b.y+b.z);
  });

  cubes.forEach(c=>{

    let color={
      top:"#4caf50",
      left:"#388e3c",
      right:"#2e7d32"
    };

    // 底部中央區改為水
    if(
      c.x>=2&&c.x<=3 &&
      c.y>=2&&c.y<=3 &&
      c.z<2
    ){
      const wave=Math.sin(time+c.x+c.y)*3;

      drawCube(
        c.x,c.y,c.z,
        tileW,tileH,tileZ,
        {
          top:"#4fc3f7",
          left:"rgba(21,101,192,0.85)",
          right:"rgba(13,71,161,0.9)"
        }
      );
      return;
    }

    drawCube(c.x,c.y,c.z,tileW,tileH,tileZ,color);

  });

  time+=0.05;
  requestAnimationFrame(render);
}

render();
</script>
</body>
</html>