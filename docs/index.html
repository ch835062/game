<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2.5D Ê∞¥Ê∑±Á´ãÊñπÈ´î</title>
<style>
body{ margin:0; background:#111; overflow:hidden; }
canvas{ display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

const mapRows = 8;
const mapCols = 8;

const map = [
  [1,1,1,1,1,1,1,1],
  [1,1,1,0,0,1,1,1],
  [1,1,0,0,0,0,1,1],
  [1,0,0,0,0,0,0,1],
  [1,1,0,0,0,0,1,1],
  [1,1,1,0,0,1,1,1],
  [1,1,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,1],
];

function isoToScreen(x,y,tileW,tileH){
  return {
    x:(x-y)*tileW/2,
    y:(x+y)*tileH/2
  };
}

let time = 0;

// ===== ÊîπËâØÁâàÊ∞¥Á´ãÊñπÈ´î =====
function drawWaterCube(x,y,tileW,tileH,depth){

  const pos = isoToScreen(x,y,tileW,tileH);
  const cx = canvas.width/2;
  const cy = canvas.height/4;

  const sx = pos.x + cx;
  const sy = pos.y + cy;

  const wave = Math.sin(time + x + y)*4;

  // Ê∞¥Èù¢Ôºà‰∫ÆÔºâ
  ctx.fillStyle = "#4fc3f7";
  ctx.beginPath();
  ctx.moveTo(sx, sy - depth + wave);
  ctx.lineTo(sx + tileW/2, sy - tileH/2 - depth + wave);
  ctx.lineTo(sx, sy - tileH - depth + wave);
  ctx.lineTo(sx - tileW/2, sy - tileH/2 - depth + wave);
  ctx.closePath();
  ctx.fill();

  // Â∑¶ÂÅ¥ÔºàÊ∞¥Ê∑±Ôºâ
  ctx.fillStyle = "rgba(21,101,192,0.8)";
  ctx.beginPath();
  ctx.moveTo(sx - tileW/2, sy - tileH/2 - depth);
  ctx.lineTo(sx - tileW/2, sy - tileH/2);
  ctx.lineTo(sx, sy);
  ctx.lineTo(sx, sy - depth);
  ctx.closePath();
  ctx.fill();

  // Âè≥ÂÅ¥ÔºàÊ∞¥Ê∑±Êõ¥ÊöóÔºâ
  ctx.fillStyle = "rgba(13,71,161,0.85)";
  ctx.beginPath();
  ctx.moveTo(sx + tileW/2, sy - tileH/2 - depth);
  ctx.lineTo(sx + tileW/2, sy - tileH/2);
  ctx.lineTo(sx, sy);
  ctx.lineTo(sx, sy - depth);
  ctx.closePath();
  ctx.fill();
}

function drawLand(x,y,tileW,tileH,height){

  const pos = isoToScreen(x,y,tileW,tileH);
  const cx = canvas.width/2;
  const cy = canvas.height/4;

  const sx = pos.x + cx;
  const sy = pos.y + cy;

  ctx.fillStyle="#4caf50";
  ctx.beginPath();
  ctx.moveTo(sx, sy - height);
  ctx.lineTo(sx + tileW/2, sy - tileH/2 - height);
  ctx.lineTo(sx, sy - tileH - height);
  ctx.lineTo(sx - tileW/2, sy - tileH/2 - height);
  ctx.closePath();
  ctx.fill();

  ctx.fillStyle="#388e3c";
  ctx.beginPath();
  ctx.moveTo(sx - tileW/2, sy - tileH/2 - height);
  ctx.lineTo(sx - tileW/2, sy - tileH/2);
  ctx.lineTo(sx, sy);
  ctx.lineTo(sx, sy - height);
  ctx.closePath();
  ctx.fill();

  ctx.fillStyle="#2e7d32";
  ctx.beginPath();
  ctx.moveTo(sx + tileW/2, sy - tileH/2 - height);
  ctx.lineTo(sx + tileW/2, sy - tileH/2);
  ctx.lineTo(sx, sy);
  ctx.lineTo(sx, sy - height);
  ctx.closePath();
  ctx.fill();
}

// ===== È≠öÂú®Êõ¥Ê∑±Ëôï =====
let fishes=[];
for(let i=0;i<6;i++){
  fishes.push({
    x:2+Math.random()*4,
    y:2+Math.random()*4,
    vx:(Math.random()-0.5)*0.02,
    vy:(Math.random()-0.5)*0.02
  });
}

function drawFish(tileW,tileH,depth){

  const cx = canvas.width/2;
  const cy = canvas.height/4;

  fishes.forEach(f=>{
    f.x+=f.vx;
    f.y+=f.vy;
    if(f.x<2||f.x>5)f.vx*=-1;
    if(f.y<2||f.y>5)f.vy*=-1;

    const pos=isoToScreen(f.x,f.y,tileW,tileH);
    const sx=pos.x+cx;
    const sy=pos.y+cy-depth/1.5; // Âú®Ê∞¥‰∏≠Êõ¥‰Ωé

    ctx.fillStyle="rgba(0,0,0,0.25)";
    ctx.beginPath();
    ctx.ellipse(sx,sy,tileW/6,tileH/4,0,0,Math.PI*2);
    ctx.fill();
  });
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const tileW=Math.min(canvas.width,canvas.height)/8;
  const tileH=tileW/2;

  const landHeight=tileW/2;
  const waterDepth=tileW; // üî• Âä†Ê∑±Ê∞¥È´òÂ∫¶

  for(let y=0;y<mapRows;y++){
    for(let x=0;x<mapCols;x++){
      if(map[y][x]===1){
        drawLand(x,y,tileW,tileH,landHeight);
      }else{
        drawWaterCube(x,y,tileW,tileH,waterDepth);
      }
    }
  }

  drawFish(tileW,tileH,waterDepth);

  time+=0.05;
  requestAnimationFrame(render);
}

render();
</script>
</body>
</html>