<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FC 釣魚戰鬥</title>
<style>
body{
  margin:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
canvas{
  width:512px;
  height:480px;
  image-rendering:pixelated;
}
</style>
</head>
<body>

<canvas id="game" width="256" height="240"></canvas>

<script>
const c=document.getElementById("game");
const ctx=c.getContext("2d");
ctx.imageSmoothingEnabled=false;

let frame=0;
let tension=0;
let battle=false;
let hooked=false;

/* ================= 背景 ================= */

function drawWater(){
  const g=ctx.createLinearGradient(0,0,0,240);
  g.addColorStop(0,"#4fa6ff");
  g.addColorStop(0.4,"#2f5bff");
  g.addColorStop(1,"#1a1fa8");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,256,240);

  ctx.fillStyle="#fff";
  for(let i=0;i<256;i+=8){
    ctx.fillRect(i,35+Math.sin((i+frame)*0.05)*2,6,3);
  }
}

function drawFishingLine(){
  ctx.strokeStyle="#000";
  ctx.lineWidth=1;

  ctx.beginPath();
  ctx.moveTo(128,0);

  if(hooked){
    ctx.lineTo(fish.x,fish.y);
  }else{
    ctx.lineTo(128,160);
  }

  ctx.stroke();
}

/* ================= 魚 ================= */

class Fish{
  constructor(){
    this.x=80;
    this.y=130;
    this.dir=1;
    this.speed=0.5;
    this.state="swim";
  }

  update(){
    if(!battle){
      this.x+=this.speed*this.dir;
      if(this.x>220||this.x<30) this.dir*=-1;

      // 靠近魚線觸發咬餌
      if(Math.abs(this.x-128)<10 && Math.random()<0.01){
        this.state="bite";
      }

      if(this.state==="bite"){
        if(frame%30===0){
          battle=true;
          hooked=true;
        }
      }
    }else{
      // 戰鬥左右爆衝
      this.x+= (Math.random()-0.5)*4;

      if(this.x<20) this.x=20;
      if(this.x>236) this.x=236;

      tension+=Math.abs(this.x-128)*0.02;

      if(tension>100){
        alert("爆線！");
        reset();
      }
    }
  }

  draw(){
    ctx.fillStyle="#cfd6dd";
    ctx.fillRect(this.x-16,this.y-6,28,12);
    ctx.fillStyle="#9ea6b3";
    ctx.fillRect(this.x-16,this.y,28,6);
    ctx.strokeStyle="#000";
    ctx.strokeRect(this.x-16,this.y-6,28,12);

    if(this.state==="bite" && frame%20<10){
      ctx.fillStyle="#ffff00";
      ctx.fillText("!",this.x-2,this.y-15);
    }
  }
}

let fish=new Fish();

/* ================= 張力條 ================= */

function drawTensionBar(){
  ctx.fillStyle="#000";
  ctx.fillRect(230,20,10,180);

  ctx.fillStyle="#00ff00";
  ctx.fillRect(230,200-tension*1.5,10,tension*1.5);
}

/* ================= 控制 ================= */

document.addEventListener("keydown",e=>{
  if(battle && e.key===" "){
    tension-=5;
    if(tension<0)tension=0 reminder;
  }
});

function reset(){
  tension=0;
  battle=false;
  hooked=false;
  fish=new Fish();
}

/* ================= 主迴圈 ================= */

function loop(){
  ctx.clearRect(0,0,256,240);

  drawWater();
  drawFishingLine();

  fish.update();
  fish.draw();

  if(battle) drawTensionBar();

  frame++;
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>